<!DOCTYPE html>
<html lang="en">
<%- include('../partials/head')-%>

  <body>
    <main>
      <%- include('../partials/nav')-%>
        <div class="container col-xxl-12 pt-2 pb-5">
          <div class="row flex-lg-row-reverse align-items-lg-start g-5">
            <div class="col-12 col-lg-8">
              <h4 class="section-title">Nations List</h4>
              <div class="table-wrapper">
                <table class="table table-hover table-bordered">
                  <thead>
                    <tr>
                      <th scope="col">#</th>
                      <th scope="col">Name</th>
                      <th scope="col">Description</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% nations.forEach(function(nation,index){ %>
                      <tr>
                        <td>
                          <%= index + 1 %>
                        </td>
                        <td>
                          <%= nation.name %>
                        </td>
                        <td>
                          <%= nation.description %>
                        </td>
                        <td>
                          <div class="buttons are-small">
                            <a href="/nations/<%= nation._id %>"><button class="btn btn-warning">Edit</button></a>
                            <button class="btn btn-danger" data-bs-toggle="modal"
                              data-bs-target="#deleteModal<%= nation._id %>">Delete</button>
                          </div></a>
                        </td>
                      </tr>

                      <% })%>
                  </tbody>
                </table>
              </div>
            </div>
            <div class="col-12 col-lg-4">
              <h4 class="section-title">Create Nation Form</h4>
              <form action="/nations" method="POST" class="form-bordered">
                <div class="mb-3">
                  <label for="playerName" class="form-label">Nation name</label>
                  <input type="text" class="form-control" id="pname" name="name" placeholder="e.g Brazil" />
                </div>
                <div class="mb-3">
                  <label for="description" class="form-label">Description</label>
                  <input type="text" class="form-control" id="pdescription" name="description" />
                </div>

                <button type="submit" class="btn btn-bd-primary w-100">Submit</button>
              </form>
            </div>
          </div>
        </div>
        <%- include('../partials/footer')-%>
          <!-- Toast -->
          <%- include('../partials/toast')-%>
            <!-- Modal -->
    </main>
    <script>
      document.querySelector('form').addEventListener('submit', function (event) {
        event.preventDefault();

        var formData = new FormData(event.target);
        var data = Object.fromEntries(formData);

        fetch('/nations', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        }).then(response => {
          var toastEl;
          if (response.ok) {
            toastEl = document.querySelector('#successToast');
          } else {
            toastEl = document.querySelector('#errorToast');
          }
          var toast = new bootstrap.Toast(toastEl);
          toast.show();

          if (response.ok) {
            setTimeout(function () {
              window.location.href = '/nations';
            }, 500);
          }
        }).catch(error => {
          console.error('Error:', error);
          var toastEl = document.querySelector('#errorToast');
          var toast = new bootstrap.Toast(toastEl);
          toast.show();
        });
      });
    </script>
  </body>

</html>