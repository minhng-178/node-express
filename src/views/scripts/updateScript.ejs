<script>
  var validationRules = {
    oname: {
      test: function (value) {
        return value !== "";
      },
      message: "Orchid Name is required",
    },
    oimage: {
      test: function (value) {
        return value !== "";
      },
      message: "Image URL is required",
    },
    ocolor: {
      test: function (value) {
        return value !== "";
      },
      message: "Color is required",
    },
    oprice: {
      test: function (value) {
        return value !== "" && !isNaN(value) && value >= 0 && value < 1000000;
      },
      message: "Invalid Price",
    },
    isNatural: {
      test: function () {
        return (
          document.getElementById("isNaturalYes").checked ||
          document.getElementById("isNaturalNo").checked
        );
      },
      message: "Please select whether the orchid is natural or not",
    },
    ooriginal: {
      test: function (value) {
        return value !== "Open this select menu";
      },
      message: "Please select an Original name",
    },
  };

  function showError(id, message) {
    document.getElementById(id + "Error").textContent = message;
  }

  var data;

  document.querySelector("form").addEventListener("submit", function (event) {
    event.preventDefault();

    var isValid = true;

    for (var id in validationRules) {
      var value = id === "isNatural" ? null : document.getElementById(id).value;
      if (!validationRules[id].test(value)) {
        showError(id, validationRules[id].message);
        isValid = false;
      } else {
        showError(id, "");
      }
    }

    if (isValid) {
      var formData = new FormData(event.target);
      data = Object.fromEntries(formData);

      // Open the update modal
      var updateModal = new bootstrap.Modal(
        document.getElementById("updateModal")
      );
      updateModal.show();
    }
  });

  document
    .querySelector("#updateModal .btn-warning")
    .addEventListener("click", function () {
      if (!data) {
        return;
      }

      fetch(`/orchids/${data._id}?_method=PUT`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(data),
      })
        .then((response) => {
          var toastEl;
          if (response.ok) {
            fetch(`/orchids/${data._id}`)
              .then((response) => response.text())
              .then((html) => {
                document.documentElement.innerHTML = html;
                var toastEl = document.querySelector("#successToast");
                var toast = new bootstrap.Toast(toastEl);
                toast.show();
              })
              .catch((error) => console.error("Error:", error));
          } else {
            toastEl = document.querySelector("#errorToast");
          }
        })
        .catch((error) => {
          console.error("Error:", error);
          var toastEl = document.querySelector("#errorToast");
          var toast = new bootstrap.Toast(toastEl);
          toast.show();
        });
    });
</script>
