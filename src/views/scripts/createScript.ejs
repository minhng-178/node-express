<script>
  document.querySelector("form").addEventListener("submit", function (event) {
    event.preventDefault();

    var validationRules = {
      oname: {
        test: function (value) {
          return value !== "";
        },
        message: "Orchid Name is required",
      },
      oimage: {
        test: function (value) {
          return value !== "";
        },
        message: "Image File is required",
      },
      ocolor: {
        test: function (value) {
          return value !== "";
        },
        message: "Color is required",
      },
      oprice: {
        test: function (value) {
          return value !== "" && !isNaN(value) && value >= 0 && value < 1000000;
        },
        message: "Invalid Price",
      },
      isNatural: {
        test: function () {
          return (
            document.getElementById("isNaturalYes").checked ||
            document.getElementById("isNaturalNo").checked
          );
        },
        message: "Please select whether the orchid is natural or not",
      },
      ooriginal: {
        test: function (value) {
          return value !== "Open this select menu";
        },
        message: "Please select an Original name",
      },
    };

    var isValid = true;

    function showError(id, message) {
      var errorMessageElement = document.getElementById(id + "Error");
      if (message) {
        errorMessageElement.textContent = message;
        isValid = false;
      } else {
        errorMessageElement.textContent = "";
      }
    }

    for (var id in validationRules) {
      var value = id === "isNatural" ? null : document.getElementById(id).value;
      if (!validationRules[id].test(value)) {
        showError(id, validationRules[id].message);
      } else {
        showError(id, "");
      }
    }

    if (isValid) {
      submitForm(event.target);
    }
  });

  // function uploadFile(form) {
  //   var formData = new FormData(form);
  //   fetch("/upload", { method: "POST", body: formData })
  //     .then((response) => response.json())
  //     .then((result) => {
  //       if (result.fileURL) {
  //         document.querySelector("#hiddenFileURL").value = result.fileURL;
  //         formData.set("image", result.fileURL);
  //         submitForm(form, formData);
  //       }
  //     })
  //     .catch((error) => console.error("Error:", error));
  // }

  function submitForm(form) {
    var formData = new FormData(form);
    var data = Object.fromEntries(formData);
    fetch("/orchids", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(data),
    })
      .then((response) => {
        var toastEl;
        if (response.ok) {
          fetch("/orchids")
            .then((response) => response.text())
            .then((html) => {
              document.documentElement.innerHTML = html;
              var toastEl = document.querySelector("#successToast");
              var toast = new bootstrap.Toast(toastEl);
              toast.show();
              history.pushState({}, "", "/orchids");
            })
            .catch((error) => console.error("Error:", error));
        } else {
          toastEl = document.querySelector("#errorToast");
        }
      })
      .catch((error) => {
        console.error("Error:", error);
        var toastEl = document.querySelector("#errorToast");
        var toast = new bootstrap.Toast(toastEl);
        toast.show();
      });
  }
</script>
